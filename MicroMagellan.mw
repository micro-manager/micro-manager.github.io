

The Micro-Magellan plugin allows flexible, dynamic device control and acquisition. The Explore feature allows you to examine your sample in XY and Z, building a 3D map of all areas covered, minimizing photo-bleaching and damage while finding areas of interest. Surfaces allows you to define an non-cuboidal region of interest and define sample morphology, which can then be used to define sample-driven parameters such as laser power at distance from surface. Using grids or surfaces, you can designate multiple areas to image in a single acquisition in series or in parallel.  

==Getting Started with Micro-Magellan==
In order for Micro-Magellan to operate, it needs to know the direction of Z movement. This is defined in the Hardware Configuration Wizard.

[[File:Zdirection.jpg]]

In order for Micro-Magellan to acquire tiled images and assemble them, it must have an accurate pixel size calibration for the objective in use. If you have already calibrated your pixel size using the “Pixel size calibrator” plug-in from MicroManager, this should automatically propagate to Micro-Magellan. Before using Explore mode, verify that the calibration is correct by pressing “Calibrate”. 
If the fields are populated as below, Micro-Magellan has the necessary information. These parameters can be adjusted manually to fine tune stage movement for improved stitching. 
If the calibration window shows a size of 0.0um, you can run click Start and follow the wizard instructions to generate an affine transform.

[[File:Calibration.jpg]]

==Setting Up Micro-Magellan for Device Control :==

From the plug-ins menu, select Micro-Magellan, and the unpopulated window opens. Select "Configure Device Control" 

[[File:ConfigureDeviceControl.jpg]]

A new window will open with a list of available devices and properties. You may also enter a "nickname" that more easily identifies the device/property. Selected devices/properties will appear in the Device status/control tab after pressing "Ok"

[[File:SelectProperties.jpg]]

==Using Explore Mode :==
Before exploring your sample you will need to enter your desired Z-step size and tile overlap. The channel group drop down is analogous to the channel group drop down within MicroManager’s Multi-Dimensional Acquisition and will be pre-populated with the configurations groups you have created. Select the settings group that contains your channel configurations.

[[File:ExploreSettings.jpg]]

Pressing “Explore!” will open a new window:
[[File:ExploreWindow.jpg]]

On the left side is your image area; a field of view will highlight blue as you hover over it. On the right, are look-up tables (LUTs) for each channel and several other acquisition setup parameters.  
To acquire an image in that area click to select (area will highlight green during active selection), once your selection is highlighted magenta, click again to confirm. You can click and drag to select multiple fields of view to be imaged. 
The "Z limits" scroll bars below the image window control which Z locations will be imaged, and will adjust automatically to the selected Z-step size.

[[File:ExploreZ.jpg]]

Once you have begun to image, the Z-plane currently being displayed will appear dark green in the Z-limits scroll bars. Other acquired Z-planes will appear light green. In the example above, a Z-stack has already been collected (light green), and additional Z-planes will be collected between the new Z-limits.

You can review acquired images by scrolling with the “Z” bar, and right-clicking and dragging to navigate in the XY plane. You can also zoom in and out by using the mouse scroll wheel with the image window selected.

Once you have explored your sample and would like to select areas to image over time, with more optimized parameters, better Z-resolution, etc. you can use either the “Grids” or “Surfaces” tab above the LUTs to do so.

===Grids===
In the Grids tab, you can define an N x N grid, which will appear over your explored image. With the Grids tab active, you can drag this grid over the area you would like to image. You may generate multiple grids of different sizes by pressing “New Grid”, and then move them to different areas.

[[File:ExploreGrids.jpg]]

[[File:ExploreGridsImage.jpg]]

All of the grids generated in explore mode will populate the “grids”  tab at the top of the Micro-Magellan main window, next to the Device status/control tab. If you are creating multiple grids, it may be helpful to toggle back to the Micro-Magellan main window, and select and rename the grids with their identifying features (ie: airway, duct, tumor).


===Surfaces===
The surfaces tab allows you to define the morphology of the sample by defining the edges at multiple Z-planes; Micro-Magellan then interpolates between the outlines to generate a 3D representation of the sample which can then be used to adjust which fields are acquired to avoid collecting empty space, or vary hardware settings in a sample dependent manner.
To begin drawing a surface, first define whether the sample is above or below the surface. In this example "below surface" was selected, so the first plane was the very top of the lymph node being imaged, and points were added around the perimeter. 

[[File:ExploreSurfacesDrawTop.jpg]]

The Z-slider is then moved down further into the sample, and the outline is adjusted. 

[[File:ExploreSurfacesDrawBottom.jpg]]

Once you are satisfied with the grids or surfaces generated, you can return to the main Micro-Magellan window to set up an acquisition.


==Acquisition :==
All of the grids and surfaces generated in Explore mode will populate the "grids" and "surfaces" tabs at the top of the Micro-Magellan main window, ext to the Device status/control tab. 

[[File:AcquireGridSurfaces.jpg]]

Below the Explore mode settings, there are a series of tabs to manage acquisition setup.
The "Save" tab allows you to define the name of the acquisition and uses the same directory as the explore mode. To set up a simple single area acquisition, enter a name fore the file. 
In the "Time" tab, you can enter a time interval between image acquisition and the total number of time points to acquire

[[File:AcquireTime.jpg]]

In the “Space” tab there are several options for defining the volume you want to image. In a simple Z-stack you enter start and end Z positions, and either the grid or surface to define XY location and positions. 
If you have created surfaces, you can also elect to image the area between two defined surfaces with a buffer on either side.

[[File:AcquireSpaceVolbtwnSurf.jpg]]

Imaging within a distance from a defined surface allows you to collect non-cuboidal volumes by using the edges of your surface to choose the XY positions that are collected at each Z-plane (example of XY footprints below). By selecting a Z-distance below a surface to image, you can also avoid collecting “blank” data in deep areas of the sample where there is no information due to scattering.

[[File:SurfacesNonCube.jpg]]

The “Channels” tab allows you select which of the available channels to collect, and the exposure time for each. 
The “Covaried Settings” tab allows you to vary one hardware setting depending on the state/value of another hardware device/setting. The “+” button on the left brings up the window below, allowing you to select one hardware setting as the independent variable, and a second as the dependent variable. 

[[File:AcquireCoVariedIndependent.jpg]]

In the example below, the position of the Z-stage determines the EOM voltage (laser power), so that laser power can be increased to compensate for scattering deeper in the sample. 

[[File:AcquiredCovariedPair.jpg]]

To set interpolation points for the covaried settings, select the "+" button at the bottom right. 
If you have defined surfaces, you can also choose to vary hardware settings based on surface data. 

[[File:AcquireCovariedSurface.jpg]]

For a given tissue type and morphology, these parameters may be optimized and saved for use across samples. To load a saved set of interpolation points and settings, click “load” and select the saved parameter file. You will be prompted to select which surface you would like to assign the settings to, and which surface parameter you would like to use.

[[File:AcquireSurfacesLoadPreset.jpg]]

===Drift Compensation===
Drift compensation allows you to use a single channel that represents the static features of your sample, and use it to correct for Z drift. 

[[File:AcquireDriftComp.jpg]]

===Setting Up Multiple Acquisitions===
To acquire more than a single grid or surface at a time, select the “Setup multiple acquisitions” tab. Click “+”, this will add a line with the name currently entered in the “Saving” tab below. Enter the parameters for this acquisition in the other acquisition settings tabs. 

[[File:AcquireMultiAcq.jpg]]

Clicking “+” again will add another line, it will appear with the same name. Highlight the second (new) acquisition and change its name in the “Saving” tab below, and change necessary parameters in the other acquisition settings tabs.
"Run all" will sequentially complete all acquisitions listed. 

If you would would like to collect time data in different areas concurrently (rather than completing a time lapse in one area, and then beginning the second time lapse in another area), select “interleave” and then  “Run all”

[[File:AcquireMultiAcqInterleave.jpg]]

==Using Micro-Magellan with BigDataViewer :==
Micro-Magellan writes data in a multiresolution file format that is compatible with FIJI's BigDataViewer (http://fiji.sc/BigDataViewer), a reslicing browser for terabyte-sized image volumes that is integrated with a number of image processing tools. In order for BigDataViewer to recognize the Micro-Magellan file format, the "Magellan.jar" file must be copied into a FIJI installation. To do this:

1) Open FIJI and select Help--Update <br>
2) Click the "Manage Update Sites" button <br>
3) Check the box next to Micro-Magellan <br>
4) Click "Close" <br>
5) Click "Apply changes" <br>


<table><tr><td>'''User Guide:'''</td><td valign="top">[[Media:Micro-MagellanUserGuide.pdf]]</td></tr>
<tr><td>'''Author:'''</td><td>Henry Pinkard</td></tr>

<tr><td width=20%></td><td></td></tr>
<tr><td>'''Available since version:'''</td><td>1.4.22</td>
