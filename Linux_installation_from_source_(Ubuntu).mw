{{Note|These instructions are mostly complete, but the Java part does not compile due to it not finding <code>jni.h</code> [[User:P.nanda|P.nanda]] 17:04, 23 August 2013 (PDT)}}

== Preparation ==

=== Install ImageJ ===

[http://rsb.info.nih.gov/ij/download.html Download the Linux version of ImageJ] from the NIH website.  From a terminal, unzip to <code>/usr/local/</code> and test that it runs:

{{MessageBox|1=Commandline|2=<pre>

cd ~/Downloads/
sudo unzip ij*-linux*.zip -d /usr/local/
sudo chmod +r /usr/local/ImageJ
cd /usr/local/ImageJ/
./jre/bin/java -jar ij.jar
</pre>}}

=== Install JDK ===

If you are building the Micro-Manager Java GUI, Java 1.6 is recommended[http://imagej.1557.x6.nabble.com/Java-error-when-compiling-a-plugin-tp5004378p5004386.html].  Download and run <code>jdk-6*-linux-*.bin</code> per the [https://help.ubuntu.com/community/Java#JDK_or_JRE JDK Ubuntu instructions].  This file has to be fetched from Oracle's website since their licensing prohibits redistribution in Linux repositories.  [http://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-javase6-419409.html#jdk-6u45-oth-JPR Download the latest jdk-6*-linux-*.bin] from the archives (you must click "Accept License Agreement").  It may be worth using [[#OpenJDK instead of Sun JDK]]

In spite of using Sun JDK, Micro-Manager fails to compile:

<code>
make[1]: Entering directory `/home/andor/mm/micro-manager1.4/MMCoreJ_wrap'
/bin/bash ../libtool --tag=CXX   --mode=compile g++ -DPACKAGE_NAME=\"Micro-Manager\" -DPACKAGE_TARNAME=\"micro-manager\" -DPACKAGE_VERSION=\"1.4\" -DPACKAGE_STRING=\"Micro-Manager\ 1.4\" -DPACKAGE_BUGREPORT=\"info@micro-manager.org\" -DPACKAGE_URL=\"\" -DPACKAGE=\"micro-manager\" -DVERSION=\"1.4\" -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -DHAVE_BOOST=/\*\*/ -DHAVE_BOOST_DATE_TIME=/\*\*/ -DHAVE__USR_INCLUDE_ZLIB_H=1 -DHAVE_LIBDL=1 -DSTDC_HEADERS=1 -DHAVE__BOOL=1 -DHAVE_STDBOOL_H=1 -DSTDC_HEADERS=1 -DHAVE_MEMSET=1 -I.    -I/usr/include -g -O -MT MMCoreJ_wrap.lo -MD -MP -MF .deps/MMCoreJ_wrap.Tpo -c -o MMCoreJ_wrap.lo MMCoreJ_wrap.cxx
libtool: compile:  g++ -DPACKAGE_NAME=\"Micro-Manager\" -DPACKAGE_TARNAME=\"micro-manager\" -DPACKAGE_VERSION=\"1.4\" "-DPACKAGE_STRING=\"Micro-Manager 1.4\"" -DPACKAGE_BUGREPORT=\"info@micro-manager.org\" -DPACKAGE_URL=\"\" -DPACKAGE=\"micro-manager\" -DVERSION=\"1.4\" -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" "-DHAVE_BOOST=/**/" "-DHAVE_BOOST_DATE_TIME=/**/" -DHAVE__USR_INCLUDE_ZLIB_H=1 -DHAVE_LIBDL=1 -DSTDC_HEADERS=1 -DHAVE__BOOL=1 -DHAVE_STDBOOL_H=1 -DSTDC_HEADERS=1 -DHAVE_MEMSET=1 -I. -I/usr/include -g -O -MT MMCoreJ_wrap.lo -MD -MP -MF .deps/MMCoreJ_wrap.Tpo -c MMCoreJ_wrap.cxx  -fPIC -DPIC -o .libs/MMCoreJ_wrap.o
MMCoreJ_wrap.cxx:160:17: fatal error: jni.h: No such file or directory
compilation terminated.
make[1]: *** [MMCoreJ_wrap.lo] Error 1
make[1]: Leaving directory `/home/andor/mm/micro-manager1.4/MMCoreJ_wrap'
make: *** [all-recursive] Error 1
</code>

=== Install Build Programs and Libraries ===

You will need a subversion client to checkout the source code, several libraries, and build tools.  Install them with:

{{MessageBox|1=Commandline|2=<pre>

sudo apt-get install subversion build-essential automake libtool \
                     libboost-all-dev zlib1g-dev swig
</pre>}}

You may also need to install additional packages (for cameras and special hardware).  See the full list in [[#Dependencies]]

=== Fetch Source Repositories ===

Create a directory for the the subversion repositories, such as <code>~/mm</code>.  Besides the source tree, additional binary dependencies are stored in the <code>3rdpartypublic</code> repository.  The build scripts in the source tree assume <code>3rdpartypublic</code> is in the same parent folder level:

{{MessageBox|1=Commandline|2=<pre>

mkdir ~/mm
cd ~/mm
svn co https://valelab.ucsf.edu/svn/micromanager2/trunk/ micro-manager1.4
svn co https://valelab.ucsf.edu/svn/3rdpartypublic/
</pre>}}

This creates 2 new folders in the <code>mm</code> directory:
<pre>
    ~/mm/micro-manager1.4
    ~/mm/3rdpartypublic
</pre>

Add the Beanshell and SwingX to the ImageJ plugins directory:

{{MessageBox|1=Commandline|2=<pre>

cd ~/mm/3rdpartypublic/classext
sudo cp bsh-2.0b4.jar swingx-0.9.5.jar /usr/local/ImageJ/plugins/
</pre>}}

Create a new micro-manager directory in /usr/lib/

{{MessageBox|1=Commandline|2=<pre>

sudo mkdir /usr/lib/micro-manager
</pre>}}

== Building Micro-Manager ==

=== Create the Autotools files ===

<code>configure</code> uses the bundled version of ImageJ:

{{MessageBox|1=Commandline|2=<pre>

cd ~/mm/micro-manager1.4
./mmUnixBuild.sh
./configure --with-imagej=/usr/local/ImageJ
</pre>}}

=== Compile ===

{{MessageBox|1=Commandline|2=<pre>

make
</pre>}}

=== Install ===

{{MessageBox|1=Commandline|2=<pre>

sudo make install
sudo ldconfig
</pre>}}

== Post Install ==

=== Create the startup script ===

Micro-Manager requires the path to <code>/usr/lib/micro-manager</code>. Create the 4 line Bash script below in <code>/usr/local/ImageJ</code> and save it as, say, <code>mmscript</code>.

{{MessageBox|1=File: mmscript|2=<pre>

#!/bin/bash
cd /usr/local/ImageJ
export LD_LIBRARY_PATH=.:/usr/local/lib:/usr/lib/micro-manager:/usr/local/ImageJ
java -mx1200m \
     -Djava.library.path=/usr/lib/micro-manager:/usr/local/ImageJ \
     -Dplugins.dir=/usr/local/ImageJ \
     -cp /usr/local/ImageJ/ij.jar:usr/local/jdk1.5.0_04/lib/tools.jar \
      ij.ImageJ
</pre>}}

Make the script executable:

{{MessageBox|1=Commandline|2=<pre>

sudo chmod +x mmscript
</pre>}}

== Running Micro-Manager ==

Start ImageJ with your new script:

{{MessageBox|1=Commandline|2=<pre>

./mmscript &
</pre>}}

Run <code>Plugins > Micro-Manager > Micro-Manager Studio</code>

== Appendix ==

=== Dependencies ===

{| class="wikitable"
|+ You need the following packages:
! Name || Equivalent Synaptic package name
|-
|colspan="2"  style="background: #ddd; border-top: 1px solid gray; padding: 5px; text-align: center"| Required Dependencies:
|-
| Subversion || <code>subversion</code>
|-
| GNU C++ || <code>build-essential</code>
|-
| GNU Autotools || <code>automake</code>
|-
| GNU Libtool || <code>libtool</code>
|-
| Boost libraries || <code>libboost-all-dev</code>
|-
| zlib compression library || <code>zlib1g-dev</code>
|-
| Simplified Wrapper and Interface Library || <code>swig</code>
|-
| Sun Java SDK || N/A - manually fetch from Oracle website
|-
|colspan="2"  style="background: #ddd; border-top: 1px solid gray; padding: 5px; text-align: center"| Optional Dependencies:
|-
| Firewire Camera Library || <code>libdc1394-*-dev</code>
|-
| Open Source Computer Vision Library || <code>libopencv-dev</code>
|}

=== OpenJDK instead of Sun JDK ===

It may be possible to also use the distro-friendly OpenJDK (<code>default-jdk</code>) without too much effort. To start, you would have to patch the Micro-Manager <code>configure.in</code> file to find <code>jni.h</code>[https://bugzilla.redhat.com/show_bug.cgi?id=498964#c2] and possibly apply other fixes.

{{Programming_Sidebar}}
