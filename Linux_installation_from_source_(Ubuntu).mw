= Preparation =

== Install JDK ==

If you are building the Micro-Manager Java GUI, Java 1.6 or 1.7 is recommended[http://imagej.1557.x6.nabble.com/Java-error-when-compiling-a-plugin-tp5004378p5004386.html]. The simplest way is to use [https://launchpad.net/~webupd8team/+archive/java webupd8team PPA]:

{{MessageBox|1=Commandline|2=<pre>

sudo add-apt-repository ppa:webupd8team/java
sudo apt-get install oracle-java7-installer
</pre>}}

Alternatively, you can download and run <code>jdk-7*-linux-*.bin</code> per the [https://help.ubuntu.com/community/Java#JDK_or_JRE JDK Ubuntu instructions].   [http://www.oracle.com/technetwork/java/javase/downloads/jdk7-downloads-1880260.html Download the latest jdk-7*-linux-*.bin] from the archives (you must click "Accept License Agreement").

{{Note|It may be worth trying to use [[#OpenJDK instead of Sun JDK]]}}

== Install ImageJ ==

Ensure you don't have the Ubuntu package installed:

{{MessageBox|1=Commandline|2=<pre>

sudo apt-get purge imagej
</pre>}}

[http://rsb.info.nih.gov/ij/download.html Download the Linux version of ImageJ] from the NIH website.  From a terminal, unzip to <code>/usr/local/</code> and test that it runs:

{{MessageBox|1=Commandline|2=<pre>

cd ~/Downloads/
sudo unzip ij*-linux*.zip -d /usr/local/
sudo rm -rf /usr/local/ImageJ/jre # we don't need the Java runtime
sudo chmod a+Xr /usr/local/ImageJ
</pre>}}

== Install Build Programs and Libraries ==

You will need a subversion client to checkout the source code, several libraries, and build tools.  Install them with:

{{MessageBox|1=Commandline|2=<pre>

sudo apt-get install subversion build-essential automake libtool \
                     libboost-all-dev zlib1g-dev swig
</pre>}}

You may also need to install additional packages (for cameras and special hardware).  See the full list in [[#Dependencies]]

== Fetch Source Repositories ==

Create a directory for the the subversion repositories, such as <code>~/mm</code>.  Besides the source tree, additional binary dependencies are stored in the <code>3rdpartypublic</code> repository.  The build scripts in the source tree assume <code>3rdpartypublic</code> is in the same parent folder level:

{{MessageBox|1=Commandline|2=<pre>

mkdir ~/mm
cd ~/mm
svn co https://valelab.ucsf.edu/svn/micromanager2/trunk/ micro-manager1.4
svn co https://valelab.ucsf.edu/svn/3rdpartypublic/
</pre>}}

This creates 2 new folders in the <code>mm</code> directory:
<pre>
    ~/mm/micro-manager1.4
    ~/mm/3rdpartypublic
</pre>

Add the Beanshell and SwingX to the ImageJ plugins directory:

{{MessageBox|1=Commandline|2=<pre>

cd ~/mm/3rdpartypublic/classext
sudo cp bsh-2.0b4.jar swingx-0.9.5.jar /usr/local/ImageJ/plugins/
</pre>}}

= Building Micro-Manager =

== Create the Autotools files ==

<code>configure</code> uses the bundled version of ImageJ:

{{MessageBox|1=Commandline|2=<pre>

cd ~/mm/micro-manager1.4
./mmUnixBuild.sh
./configure --with-imagej=/usr/local/ImageJ \
            --with-javaincl=/usr/lib/jvm/java-7-oracle/include/
</pre>}}

== Compile ==

{{MessageBox|1=Commandline|2=<pre>

make
</pre>}}

== Install ==

{{MessageBox|1=Commandline|2=<pre>

sudo make install
sudo ldconfig
</pre>}}

= Post Install =

== Create the startup script ==

Micro-Manager requires the path to <code>/usr/lib/micro-manager</code>. Create the 4 line Bash script below in <code>/usr/local/ImageJ</code> and save it as, say, <code>mmscript</code>.

{{MessageBox|1=File: mmscript|2=<pre>

#!/bin/bash
cd /usr/local/ImageJ
export LD_LIBRARY_PATH=/usr/local/lib/micro-manager:/usr/local/ImageJ
java -mx1200m \
     -Djava.library.path=/usr/local/lib/micro-manager:/usr/local/ImageJ \
     -Dplugins.dir=/usr/local/ImageJ \
     -cp /usr/local/ImageJ/ij.jar:/usr/lib/jvm/java-7-oracle/lib/tools.jar \
      ij.ImageJ
</pre>}}

Make the script executable:

{{MessageBox|1=Commandline|2=<pre>

sudo chmod +x mmscript
</pre>}}

= Running Micro-Manager =

Start ImageJ with your new script:

{{MessageBox|1=Commandline|2=<pre>

./mmscript &
</pre>}}

Run <code>Plugins > Micro-Manager > Micro-Manager Studio</code>

= Appendix =

== Dependencies ==

{| class="wikitable"
|+ You need the following packages:
! Name || Equivalent Synaptic package name
|-
|colspan="2"  style="background: #ddd; border-top: 1px solid gray; padding: 5px; text-align: center"| Required Dependencies:
|-
| Subversion || <code>subversion</code>
|-
| GNU C++ || <code>build-essential</code>
|-
| GNU Autotools || <code>automake</code>
|-
| GNU Libtool || <code>libtool</code>
|-
| Boost libraries || <code>libboost-all-dev</code>
|-
| zlib compression library || <code>zlib1g-dev</code>
|-
| Simplified Wrapper and Interface Library || <code>swig</code>
|-
| Sun Java SDK || N/A - manually fetch from Oracle website
|-
|colspan="2"  style="background: #ddd; border-top: 1px solid gray; padding: 5px; text-align: center"| Optional Dependencies:
|-
| Firewire Camera Library || <code>libdc1394-*-dev</code>
|-
| Open Source Computer Vision Library || <code>libopencv-dev</code>
|-
| Andor SDK 2/3 || N/A - request from Andor website
|}

== OpenJDK instead of Sun JDK ==

It may be possible to also use the distro-friendly OpenJDK (<code>default-jdk</code>) without too much effort. To start, you would have to patch the Micro-Manager <code>configure.in</code> file to find <code>jni.h</code>[https://bugzilla.redhat.com/show_bug.cgi?id=498964#c2] and possibly apply other fixes.

{{Programming_Sidebar}}
