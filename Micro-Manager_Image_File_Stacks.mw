<h1>In brief</h1>

In brief:
A TIFF file or group of TIFF files that contain multiple acquired images per a single file. These files conform to the [http://www.openmicroscopy.org/site/support/file-formats/ome-tiff OME-TIFF] specification, allowing them to be easily imported into a variety of analysis applications or anything that utilizes the [http://loci.wisc.edu/software/bio-formats Bio-Formats importer].

Image file stacks are designed to be easily imported into ImageJ without the need for any special reader plugins. A stack file can be dragged onto the ImageJ toolbar and will automatically open as a hyperstack with the same contrast settings used in Micro-Manager. Any acquisition comments typed into the Multi-Dimensional Acquisition window or the comments tab of the main MM GUI can be viewed by pressing "i" with one of these files open in ImageJ.

By default, one file is created per an XY stage position (up to a maximum of 4 GB per file). In the tools-options menu, this can be changed to save all XY positions in a single file. This is especially useful for acquisitions using a large number XY positions. Since OME-TIFFs require that an identical String of XML metadata be embedded in each file in an acquisition, acquisition that have a large number of XY positions with a small amount of data at each waste space on disk by writing the same String of metadata in each file at the acquisition’s conclusion.

<h1> Format </h1>

Micro-Manager Image file stacks conform to both the [http://partners.adobe.com/public/developer/en/tiff/TIFF6.pdf TIFF Specification] and [http://www.openmicroscopy.org/site/support/file-formats/ome-tiff OME TIFF Specification], as well as data allowing them to be easily imported into ImageJ, storage of acquisition comments and display settings, and an index map of the byte offsets of images within a file to allow for optimal reading performance.

<h2> Header </h2>

Bytes 0-7: Standard TIFF Header

8-11: Index map offset header (54773648)

12-15: Index map offset

16-19: Display settings offset header (483765892)

20-23: Display settings offset

24-27: Comments offset header (99384722)

28-31: Comments offset

32-35: Summary metadata header (2355492)

36-39: Summary metadata length

40-first IFD: 1 byte for each character of summary metadata



<h2> Image File Directories</h2>

Each IFD will contain the same set of TIFF tags, except for the first one in each file, which contains two ImageJ metadata tags, and two copies of the ImageDescription tag. One of these contains a string needed by ImageJ to recognize these files, and the other contains OME metadata. Although these tags appear in the first IFD, their values will not be written until the end of the file, when it is closed. The tags are written in the following order (non-standard TIFF tags have the values listed after them):


ImageWidth
	
ImageHeight

BitsPerSample

Compression

PhotometricInterpretation

ImageDescription (first IFD only)--Contains OME XML metadata

a 2nd ImageDescription (first IFD only)-–contains ImageJ file opening information

StripOffsets

SamplesPerPixel

RowsPerStrip

StripByteCounts

XResolution

YResolution

ResolutionUnit

IJMetadataByteCounts (first IFD only) (50838)

IJMetadata (first IFD only) (50839)

MicroManagerMetadata (51123)


Immediately after these tags are written:

-4 bytes containg the offset of the next IFD (per the TIFF specification)

-In RGB files only, 6 bytes containing the values of the BitsPerSample tag
Pixel values

-16 bytes containing the values of the XResolution and YResolution tags

-The value of the MicroManagerMetadata tag: 1 byte for each character of image metadata converted to a String



--[[User:Henry Pinkard|Henry Pinkard]] 7:35, 20th March 2013 (PDT)
